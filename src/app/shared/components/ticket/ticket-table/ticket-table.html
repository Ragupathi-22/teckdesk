<div class="overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200">
    <!-- Table Header -->
    <thead class="bg-gray-50">
      <tr>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Raised By</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Asset Tag</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Issue</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
        <th *ngIf="isAdmin" class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Team</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
        <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">Action</th>
      </tr>
    </thead>

    <!-- Table Body -->
    <tbody class="bg-white divide-y divide-gray-200">
      <!-- Loading State -->
      <tr *ngIf="loading">
        <td [attr.colspan]="isAdmin ? 9 : 8" class="py-6 text-center">
          <div class="flex justify-center items-center space-x-2 text-indigo-600">
            <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" />
            </svg>
            <span>Loading tickets...</span>
          </div>
        </td>
      </tr>

      <!-- Tickets Rows -->
      <tr *ngFor="let ticket of paginatedTickets()" class="hover:bg-gray-50">
        <td class="px-5 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#{{ ticket.id.slice(0, 6) }}..</td>
        <td class="px-5 py-4 whitespace-nowrap text-sm text-gray-500">{{ ticket.raisedByName || ticket.raisedBy }}</td>
        <td class="px-5 py-4 whitespace-nowrap text-sm text-gray-500">{{ ticket.assetTag }}</td>
        <td class="px-5 py-4 whitespace-nowrap text-sm text-gray-700">{{ ticket.title }}</td>
        <td class="px-5 py-4 whitespace-nowrap text-sm text-gray-500"> {{ getTicketCategoryLabel(ticket.category) }}
        </td>
        <td *ngIf="isAdmin" class="px-5 py-4 whitespace-nowrap text-sm text-gray-500">
          {{ getTeamLabel(ticket.team) }}
        </td>
        <td class="px-5 py-4 whitespace-nowrap text-sm text-gray-500">
          {{ formatDate(ticket.timestamp) }}

        <td class="px-5 py-4 whitespace-nowrap">
          <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full"
            [ngStyle]="{ 'background-color': getTicketStatusColor(ticket.status), 'color': 'white' }">
            {{ getTicketStatusLabel(ticket.status) }}
          </span>
        </td>


        <td class="px-5 py-4 whitespace-nowrap text-right text-sm font-medium space-x-3">
          <!-- Action for Employee -->
          <ng-container *ngIf="!isAdmin">
            <button (click)="viewDetail.emit(ticket)" class="text-blue-600 hover:text-blue-800" title="View & Comment">
              <lucide-icon [name]="LucideIcon.MessageSquare" class="w-4 h-4" />
            </button>
          </ng-container>

          <!-- Actions for Admin -->
          <ng-container *ngIf="isAdmin">
            <button (click)="viewDetail.emit(ticket)" class="text-indigo-600 hover:text-indigo-800"
              title="Update Status & Comments">
              <lucide-icon [name]="LucideIcon.MessageSquare" class="w-4 h-4" />
            </button>
            <button (click)="deleteTicket.emit(ticket)" class="text-red-600 hover:text-red-800" title="Delete Ticket">
              <lucide-icon [name]="LucideIcon.Trash" class="w-4 h-4" />
            </button>
          </ng-container>
        </td>
      </tr>

      <!-- Empty State -->
      <tr *ngIf="!loading && paginatedTickets().length === 0">
        <td [attr.colspan]="isAdmin ? 9 : 8" class="text-center py-4 text-sm text-gray-500">
          No tickets found matching your criteria
        </td>
      </tr>
    </tbody>
  </table>

  <!-- All Loaded Message -->
  <div *ngIf="!loading && paginatedTickets().length === tickets.length && !loading && paginatedTickets().length != 0"
    class="text-center py-4 text-green-600 text-sm">
    âœ… All tickets are loaded.
  </div>
</div>

<!-- Pagination Button -->
<div class="text-center mt-4" *ngIf="paginatedTickets().length < tickets.length && !loading">
  <button (click)="nextPage()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded-md">
    Load More
  </button>
</div>