<div class="space-y-6">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <div>
      <h2 class="text-2xl font-bold text-gray-800">Asset Management</h2>
      <p class="text-gray-600">Manage all IT assets for {{ selectedCompany?.name }}</p>
    </div>
    <button (click)="openForm()"
      class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 md:px-4 md:py-2 rounded-md flex items-center text-sm md:text-base">
      <lucide-icon [name]="LucideIcon.Plus" class="mr-2 w-4 h-4" />
      <span class="hidden sm:inline">Add New Asset</span>
      <span class="inline sm:hidden">Add</span>
    </button>

  </div>

  <!-- Filter + Search -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div
      class="p-4 border-b border-gray-200 bg-gray-50 flex flex-col md:flex-row justify-between space-y-4 md:space-y-0">
      <div class="relative w-full md:w-1/2">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <lucide-icon [name]="LucideIcon.Search" class="text-gray-400 w-4 h-4" />
        </div>
        <input type="text" placeholder="Search by name, model, tag, assigned to..." [formControl]="searchControl"
          class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" />
      </div>
      <div class="flex space-x-4">

        <div class="flex items-center space-x-2">
          <lucide-icon [name]="LucideIcon.Funnel" class="text-gray-500 w-4 h-4" />
          <select [formControl]="filterStatusControl"
            class="block border border-gray-300 rounded-md py-2 px-3 text-sm focus:outline-none">
            <option value="All">All Status</option>
            <option *ngFor="let status of filteredStatus" [value]="status.status">{{ status.status }}</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div *ngIf="loadingTable()" class="text-center py-4 text-indigo-600">Loading...</div>
    <div *ngIf="!loadingTable()" class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Asset</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">TAG</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Team</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Assigned To</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Purchase Date</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let asset of paginatedAssets()" class="hover:bg-gray-50">
            <td class="px-6 py-4">
              <div class="text-sm font-medium text-gray-900">{{ asset.name }}</div>
              <div class="text-sm text-gray-500">{{ asset.model }}</div>
            </td>
            <td class="px-6 py-4 text-sm text-gray-500">{{ asset.tag }}</td>
            <!-- <td class="px-6 py-4 text-sm text-gray-500">{{ asset.team }}</td> -->
            <td class="px-6 py-4 text-sm text-gray-500">
              {{ getEmployeeById(asset.assignedTo)?.team || '-' }}
            </td>

            <td class="px-6 py-4">
              <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full"
                [ngStyle]="{ 'background-color': getStatusColor(asset.status), 'color': 'white' }">
                {{ asset.status }}
              </span>

            </td>
            <td class="px-6 py-4 text-sm text-gray-500">{{ asset.assignedToName || '-' }}</td>
            <td class="px-6 py-4 text-sm text-gray-500">
              {{ asset.purchaseDate ? (asset.purchaseDate | date: 'mediumDate') : '-' }}
            </td>
            <td class="px-6 py-4 text-right text-sm font-medium space-x-3">
              <button (click)="showDetails(asset)" class="text-blue-600 hover:text-blue-900">
                <lucide-icon [name]="LucideIcon.Info" class="w-4 h-4" />
              </button>
              <button (click)="openForm(asset)" class="text-indigo-600 hover:text-indigo-900">
                <lucide-icon [name]="LucideIcon.Edit" class="w-4 h-4" />
              </button>
              <button (click)="deleteAsset(asset.id ,asset.tag)" class="text-red-600 hover:text-red-900">
                <lucide-icon [name]="LucideIcon.Trash" class="w-4 h-4" />
              </button>
            </td>
          </tr>
          <tr *ngIf="paginatedAssets().length === 0">
            <td colspan="7" class="text-center py-4 text-sm text-gray-500">No assets found matching your criteria</td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="paginatedAssets().length === filteredAssets().length" class="text-center py-4 text-green-600">âœ… All
        assets are loaded.</div>
    </div>
  </div>

  <!-- Load More -->
  <div class="text-center mt-4" *ngIf="paginatedAssets().length < filteredAssets().length">
    <button (click)="nextPage()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded-md">Load More</button>
  </div>

  <!-- Asset Form Modal (continued below in next update...) -->
  <!-- Modal Form with blur background -->
  <!-- <div class="fixed inset-0 backdrop-blur-sm bg-black bg-opacity-30 flex items-center justify-center z-50" *ngIf="showForm()"> -->
  <!-- <div
  class="fixed inset-0 z-50 flex items-center justify-center  bg-opacity-30 backdrop-blur-sm px-4 m-3 sm:px-6 py-6"
  *ngIf="showForm()"> -->
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 px-4  sm:px-6 py-6" *ngIf="showForm()">

    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl max-h-screen overflow-y-auto">
      <h3 class="text-lg font-medium text-gray-900 mb-4">
        {{ editingAssetId ? 'Edit Asset' : 'Add New Asset' }}
      </h3>

      <form [formGroup]="assetForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">

        <!-- Asset Name -->
        <div>
          <label class="text-sm font-medium text-gray-700">Asset Name *</label>
          <input formControlName="name" type="text"
            [class.border-red-500]="assetForm.get('name')?.touched && assetForm.get('name')?.invalid"
            class="w-full border p-2 rounded-md" />
        </div>

        <!-- Model -->
        <div>
          <label class="text-sm font-medium text-gray-700">Model</label>
          <input formControlName="model" type="text" class="w-full border p-2 rounded-md" />
        </div>

        <!-- Tag Number -->
        <div>
          <label class="text-sm font-medium text-gray-700">Tag Number *</label>
          <input formControlName="tag" type="text" [readonly]="editingAssetId"
            [class.border-red-500]="assetForm.get('tag')?.touched && assetForm.get('tag')?.invalid"
            class="w-full border p-2 rounded-md bg-gray-100" />
        </div>

        <!-- Assigned Team -->
        <!-- <div>
        <label class="text-sm font-medium text-gray-700">Assigned Team *</label>
        <select formControlName="team"
          [class.border-red-500]="assetForm.get('team')?.touched && assetForm.get('team')?.invalid"
          class="w-full border p-2 rounded-md">
          <option value="">Select Team</option>
          <option *ngFor="let team of filteredTeams" [value]="team.team">{{ team.team }}</option>
        </select>
      </div> -->


        <!-- Status -->
        <div>
          <label class="text-sm font-medium text-gray-700">Status *</label>
          <select formControlName="status"
            [class.border-red-500]="assetForm.get('status')?.touched && assetForm.get('status')?.invalid"
            class="w-full border p-2 rounded-md">
            <option value="">Select Status</option>
            <option *ngFor="let status of filteredStatus" [value]="status.status">{{ status.status }}</option>
          </select>
        </div>

        <ng-container *ngIf="assetForm.get('status')?.value !== 'In Stock'">

          <!-- Assigned To (Dropdown with Search) -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Assigned To</label>
            <div class="relative employee-dropdown-container">
              <input type="text" placeholder="Select user" [value]="selectedEmployeeName || ''"
                (focus)="toggleEmployeeDropdown()" readonly
                class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 cursor-pointer" />
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon [name]="LucideIcon.User" size="16" class="text-gray-400" />
              </div>

              <!-- Dropdown -->
              <div *ngIf="employeeDropdownOpen"
                class="absolute mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto z-10">
                <div class="p-2 sticky top-0 bg-white z-20 border-b">
                  <input type="text" [formControl]="employeeSearch" placeholder="Search employees..."
                    class="block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" />
                </div>

                <div *ngFor="let u of filteredEmployeeResults()" (click)="selectEmployee(u)"
                  class="cursor-pointer px-4 py-2 hover:bg-indigo-100">
                  {{ u.name }}
                </div>
                <div *ngIf="searching()">Searching...</div>

                <div *ngIf="!searching() && filteredEmployeeResults().length === 1 && employeeSearch.value?.trim()"
                  class="px-4 py-2 text-gray-500 text-sm">
                  No records found
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- OS -->
        <div>
          <label class="text-sm font-medium text-gray-700">Operating System</label>
          <input formControlName="os" type="text" class="w-full border p-2 rounded-md" />
        </div>

        <!-- RAM -->
        <div>
          <label class="text-sm font-medium text-gray-700">RAM</label>
          <input formControlName="ram" type="text" class="w-full border p-2 rounded-md" />
        </div>

        <!-- Drive -->
        <div>
          <label class="text-sm font-medium text-gray-700">Drive</label>
          <input formControlName="drive" type="text" class="w-full border p-2 rounded-md" />
        </div>

        <!-- Serial Number -->
        <div>
          <label class="text-sm font-medium text-gray-700">Serial Number</label>
          <input formControlName="serialNumber" type="text" class="w-full border p-2 rounded-md" />
        </div>

        <!-- Purchase Date -->
        <div>
          <label class="text-sm font-medium text-gray-700">Purchase Date *</label>
          <input formControlName="purchaseDate" type="date"
            [class.border-red-500]="assetForm.get('purchaseDate')?.touched && assetForm.get('purchaseDate')?.invalid"
            class="w-full border p-2 rounded-md" max="{{ today | date:'yyyy-MM-dd' }}" />
        </div>

        <!-- History -->
        <div class="md:col-span-2">
          <label class="text-sm font-medium text-gray-700">Asset History</label>
          <textarea formControlName="history" rows="3" class="w-full border p-2 rounded-md"
            placeholder="E.g., Last serviced: 2024-10-01, RAM changed: 2025-02-10"></textarea>
        </div>

        <!-- Peripherals -->
        <div class="md:col-span-2">
          <label class="text-sm font-medium text-gray-700">Other Peripherals</label>
          <textarea formControlName="peripherals" rows="2" class="w-full border p-2 rounded-md"></textarea>
        </div>
      </form>

      <!-- Buttons -->
      <div class="flex justify-end space-x-3 mt-4">
        <button type="button" (click)="closeForm()" class="px-4 py-2 border rounded-md text-sm">Cancel</button>
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md" [disabled]="loadingForm()"
          (click)="onSubmit()">
          <span *ngIf="loadingForm()">Saving...</span>
          <span *ngIf="!loadingForm()">{{ editingAssetId ? 'Update Asset' : 'Save Asset' }}</span>
        </button>
      </div>
    </div>
  </div>
  <app-asset-detail *ngIf="showAssetDetail()" [asset]="showAssetDetail()" [onClose]="closeDetails.bind(this)">
  </app-asset-detail>