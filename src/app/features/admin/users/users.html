<div class="space-y-6 relative">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
    <!-- Title Section -->
    <div class="text-center sm:text-left">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-800">User Management</h2>
      <p class="text-gray-600 text-sm sm:text-base">
        Manage users for {{ selectedCompany?.name }}
      </p>
    </div>

    <!-- Buttons Section -->
    <div class="flex flex-wrap justify-center sm:justify-end gap-2">
      <button (click)="generateExcel()"
        class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 md:px-4 md:py-2 rounded-md flex items-center text-sm md:text-base">
        <lucide-icon [name]="LucideIcon.Download" class="mr-2 w-4 h-4"></lucide-icon>
        <span class="hidden sm:inline">Export to Excel</span>
        <span class="inline sm:hidden">Export</span>
      </button>

      <button (click)="openForm()"
        class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 md:px-4 md:py-2 rounded-md flex items-center text-sm md:text-base">
        <lucide-icon [name]="LucideIcon.Plus" class="mr-2 w-4 h-4"></lucide-icon>
        <span class="hidden sm:inline">Add New User</span>
        <span class="inline sm:hidden">Add</span>
      </button>
    </div>
  </div>



  <!-- Filters -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div
      class="p-4 border-b border-gray-200 bg-gray-50 flex flex-col md:flex-row justify-between space-y-4 md:space-y-0">
      <div class="relative w-full max-w-xs">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <lucide-icon [name]="LucideIcon.Search" class="text-gray-400 w-4 h-4"></lucide-icon>
        </div>
        <input type="text" [formControl]="searchControl" placeholder="Search by name,email..."
          class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" />
      </div>

      <div class="flex items-center space-x-2 relative w-40">
        <lucide-icon [name]="LucideIcon.Funnel" class="text-gray-500 w-4 h-4"></lucide-icon>
        <select [formControl]="filterTeamControl"
          class="block w-full appearance-none border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-700 bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="All" class="border-b border-gray-200 py-1">All Teams</option>
          @for (team of filteredTeams; track $index) {
          <option [value]="team.team" class="border-b border-gray-200 py-1">
            {{ team.team }}
          </option>
          }
        </select>
        <div class="absolute inset-y-0 right-2 flex items-center pointer-events-none">
          <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </div>
      </div>

    </div>

    <!-- Table loading spinner -->
    <div *ngIf="loadingTable()" class="py-12 text-center">
      <div class="inline-flex items-center space-x-2 text-gray-500">
        <svg class="animate-spin h-5 w-5 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none"
          viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        <span>Loading users...</span>
      </div>
    </div>

    <!-- Table -->
    <div *ngIf="!loadingTable()" class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date Of Join</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (user of paginatedUsers(); track $index) {
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ user.name }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ user.email }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ this.selectedCompany?.code }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ user.team }}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                {{ user.role | titlecase }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ user.dateOfJoining }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <button (click)="editUser(user)" class="text-indigo-600 hover:text-indigo-900 mr-3">
                <lucide-icon [name]="LucideIcon.Edit" class="w-4 h-4"></lucide-icon>
              </button>
              <button (click)="deleteUser(user.id,user.name)" class="text-red-600 hover:text-red-900">
                <lucide-icon [name]="LucideIcon.Trash" class="w-4 h-4"></lucide-icon>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>

      <!-- No data message -->
      <div *ngIf="!filteredUsers().length" class="text-center py-6 text-sm text-gray-500">
        No users found.
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="!loadingTable() && filteredUsers().length > pageSize" class="p-4 text-center">
      <button *ngIf="paginatedUsers().length < filteredUsers().length" (click)="nextPage()"
        class="text-indigo-600 hover:underline">
        Load More
      </button>

      <p *ngIf="paginatedUsers().length >= filteredUsers().length" class="text-gray-500 text-sm mt-2">
        âœ… All users are loaded.
      </p>
    </div>


    <!-- Modal Form -->
    <!-- <div *ngIf="showForm()" class="fixed inset-0 z-50 flex items-center justify-center"> -->
    <div *ngIf="showForm()" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 px-4  sm:px-6 py-6">


      <div class="relative bg-white rounded-lg shadow-xl p-6 w-full max-w-md z-10">
        <h3 class="text-lg font-medium text-gray-900 mb-4">{{ editingUserId ? 'Edit User' : 'Add New User' }}</h3>

        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
            <input formControlName="name" type="text" class="w-full border border-gray-300 rounded-md shadow-sm p-2" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input formControlName="email" type="email"
              class="w-full border border-gray-300 rounded-md shadow-sm p-2" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Date of Joining</label>
            <input formControlName="dateOfJoining" type="date"
              class="w-full border border-gray-300 rounded-md shadow-sm p-2" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Team</label>
            <select formControlName="team" class="w-full border border-gray-300 rounded-md shadow-sm p-2">
              @for (team of filteredTeams; track $index) {
              <option [value]="team.team">{{ team.team }}</option>
              }
            </select>
          </div>

          <div class="flex justify-end space-x-3 mt-6">
            <button type="button" (click)="closeForm()"
              class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
              Cancel
            </button>
            <button type="submit" [disabled]="loadingForm()"
              class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 flex items-center">
              <svg *ngIf="loadingForm()" class="animate-spin h-4 w-4 mr-2 text-white" xmlns="http://www.w3.org/2000/svg"
                fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
              </svg>
              {{ editingUserId ? 'Update' : 'Save' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>